<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Encore</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-touch-fullscreen" content="yes" />

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    
    <%= stylesheet_link_tag "application", :media => "all" %>

    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>

    <script src="http://js.pusher.com/2.0/pusher.min.js" type="text/javascript"></script>
    <script>
      pusher = new Pusher("<%= Pusher.key %>");
    </script>

    <%= javascript_include_tag "application" %>

    <!-- Mixpanel --> 
    <script>
      (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
      typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);
      b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
      
      <% if Rails.env.development? %>
        mixpanel.init("5036ddbbdd45290f2c801a3785d920f1");
      <% elsif Rails.env.production? %>
        mixpanel.init("ca46f5eba468afd46551f7c9ced4fb6c");
      <% end %>

      <% if user_signed_in? %>
        <% if current_user.just_registered? %>
          mixpanel.alias("<%= current_user.email %>");
        <% end %>
      
        mixpanel.identify("<%= current_user.email %>");
        mixpanel.name_tag("<%= current_user.name %>");

        mixpanel.people.set({
          $email: "<%= current_user.email %>",
          $name:  "<%= current_user.name %>",
          $created: "<%= current_user.created_at %>"
        });
      <% end %>
    </script>
    <!-- End Mixpanel -->

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-40542837-1', 'encoretheapp.com');
      ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->

    <!-- First popup -->
    <script>
      if (localStorage.popUpShown != 'true') {
        $(document).on("pageshow", '.ui-page', function() {
          setTimeout(function () {
            $("#infoPopup").popup("open");

            localStorage.popUpShown = 'true';
          }, 1500);
        });
      }
    </script>
    <!-- End first popup -->

    <%= csrf_meta_tags %>
  </head>
  <body>
    <div data-role="page">
      <%= render('shared/panel') %>
      <%= render('shared/top_bar') %>

      <div data-role="content">
        <%= yield %>
      </div>

      <%= render('shared/signup_popup') %>
      <%= render('shared/info_popup') %>
      <%= render('shared/facebook_popup') %>
    </div>
  </body>
</html>
